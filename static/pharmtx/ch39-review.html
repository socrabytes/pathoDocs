<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Heart Failure Study Companion</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons (non-React version) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom styles to enhance the visual experience */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #334155; /* slate-700 */
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transform: translateY(-4px);
        }
        .step-button {
            transition: all 0.2s ease-in-out;
        }
        .step-button.active {
            background-color: #2563eb; /* blue-600 */
            color: white;
            box-shadow: 0 4px 14px 0 rgb(37 99 235 / 39%);
        }
        .patho-diagram-element {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            opacity: 0.2;
        }
        .patho-diagram-element.visible {
            opacity: 1;
            transform: scale(1.05);
        }
        .heart-container svg {
            width: 100%;
            height: auto;
            max-width: 250px;
        }
        .drug-card {
            perspective: 1000px;
        }
        .drug-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .drug-card.is-flipped .drug-card-inner {
            transform: rotateY(180deg);
        }
        .drug-card-front, .drug-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .drug-card-front {
            background-color: white;
        }
        .drug-card-back {
            background-color: #f1f5f9; /* slate-100 */
            transform: rotateY(180deg);
        }
        #stage-display, #nyha-display, #gdmt-display {
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-2">Interactive Heart Failure Study Companion</h1>
            <p class="text-lg text-slate-500">A visual guide to complement Chapter 39.</p>
        </header>

        <main class="space-y-16">
            <!-- Section 1: Pathophysiology -->
            <section id="pathophysiology" class="card p-6 md:p-8">
                <h2 class="text-3xl font-bold text-slate-800 mb-2">The Vicious Cycle of Heart Failure</h2>
                <p class="text-slate-600 mb-8">Click through the steps to see how the body's attempts to compensate for a failing heart ultimately make things worse.</p>

                <div class="flex flex-wrap justify-center gap-3 mb-8">
                    <button class="step-btn px-4 py-2 text-sm font-medium text-white bg-slate-600 rounded-lg hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 shadow-md transition-all duration-200" onclick="showStep(0)">Reset Diagram</button>
                    <button class="step-btn px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-md transition-all duration-200" onclick="showStep(1)">Step 1: Initial Injury</button>
                    <button class="step-btn px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-md transition-all duration-200" onclick="showStep(2)">Step 2: ↓ Cardiac Output</button>
                    <button class="step-btn px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-md transition-all duration-200" onclick="showStep(3)">Step 3: RAAS & SNS</button>
                    <button class="step-btn px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-md transition-all duration-200" onclick="showStep(4)">Step 4: Maladaptation</button>
                    <button class="step-btn px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-md transition-all duration-200" onclick="showStep(5)">Step 5: Progression</button>
                </div>

                <div class="relative w-full overflow-x-auto bg-slate-50 p-4 rounded-xl shadow-inner">
                    <svg id="patho-diagram" viewBox="0 0 800 450" class="min-w-[700px]">
                        <!-- Diagram elements -->
                        <g id="step1" class="patho-diagram-element">
                            <rect x="300" y="20" width="200" height="50" rx="10" fill="#fef3c7" stroke="#f97316" stroke-width="2" filter="drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1))" />
                            <text x="400" y="50" text-anchor="middle" font-weight="bold" class="fill-slate-800">Initial Myocardial Injury</text>
                            <path d="M 400 70 V 100" stroke="#64748b" stroke-width="2.5" marker-end="url(#arrow)"/>
                            <rect x="300" y="100" width="200" height="50" rx="10" fill="#fef3c7" stroke="#f97316" stroke-width="2" filter="drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1))"/>
                            <text x="400" y="130" text-anchor="middle" font-weight="bold" class="fill-slate-800">Decreased Cardiac Output</text>
                        </g>

                        <g id="step2" class="patho-diagram-element">
                           <path d="M 400 150 V 180" stroke="#64748b" stroke-width="2.5" marker-end="url(#arrow)"/>
                            <rect x="250" y="180" width="300" height="40" rx="10" fill="#fee2e2" stroke="#ef4444" stroke-width="2" filter="drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1))"/>
                            <text x="400" y="205" text-anchor="middle" font-weight="bold" class="fill-slate-800">Neurohormonal Activation</text>
                            
                            <path d="M 300 220 L 200 250" stroke="#64748b" stroke-width="2.5" marker-end="url(#arrow)"/>
                            <rect x="100" y="250" width="200" height="50" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" filter="drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1))"/>
                            <text x="200" y="280" text-anchor="middle" font-weight="bold" class="fill-slate-800">SNS Activation</text>

                            <path d="M 500 220 L 600 250" stroke="#64748b" stroke-width="2.5" marker-end="url(#arrow)"/>
                            <rect x="500" y="250" width="200" height="50" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" filter="drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1))"/>
                            <text x="600" y="280" text-anchor="middle" font-weight="bold" class="fill-slate-800">RAAS Activation</text>
                        </g>
                        
                        <g id="step3" class="patho-diagram-element">
                             <path d="M 200 300 V 330" stroke="#64748b" stroke-width="2.5" marker-end="url(#arrow)"/>
                             <rect x="50" y="330" width="300" height="50" rx="10" fill="#fecaca" stroke="#dc2626" stroke-width="2" filter="drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1))"/>
                             <text x="200" y="350" text-anchor="middle" font-weight="bold" class="fill-slate-800">↑ HR, ↑ Contractility, Vasoconstriction</text>
                             <text x="200" y="368" text-anchor="middle" class="fill-slate-700">(↑ Afterload)</text>

                             <path d="M 600 300 V 330" stroke="#64748b" stroke-width="2.5" marker-end="url(#arrow)"/>
                             <rect x="450" y="330" width="300" height="60" rx="10" fill="#fecaca" stroke="#dc2626" stroke-width="2" filter="drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1))"/>
                             <text x="600" y="348" text-anchor="middle" font-weight="bold" class="fill-slate-800">Na+ & Water Retention,</text>
                             <text x="600" y="363" text-anchor="middle" font-weight="bold" class="fill-slate-800">Vasoconstriction</text>
                             <text x="600" y="378" text-anchor="middle" class="fill-slate-700">(↑ Preload & Afterload)</text>
                        </g>

                        <g id="step4" class="patho-diagram-element">
                             <path d="M 200 380 C 100 420, 100 20, 300 20" stroke="#dc2626" stroke-width="2.5" stroke-dasharray="5,5" fill="none" marker-end="url(#arrow-red)"/>
                             <path d="M 600 395 C 700 435, 700 20, 500 20" stroke="#dc2626" stroke-width="2.5" stroke-dasharray="5,5" fill="none" marker-end="url(#arrow-red)"/>
                             <rect x="275" y="390" width="250" height="60" rx="10" fill="#fee2e2" stroke="#dc2626" stroke-width="2" filter="drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1))"/>
                             <text x="400" y="405" text-anchor="middle" font-size="0.9em" font-style="italic" class="fill-slate-700">Maladaptive Outcomes:</text>
                             <text x="400" y="420" text-anchor="middle" font-weight="bold" class="fill-slate-800">Increased Cardiac Workload</text>
                             <text x="400" y="435" text-anchor="middle" font-weight="bold" class="fill-slate-800">& Ventricular Remodeling</text>
                        </g>

                        <g id="step5" class="patho-diagram-element">
                            <rect x="325" y="460" width="150" height="40" rx="10" fill="#fecaca" stroke="#dc2626" stroke-width="2" filter="drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.1))"/>
                            <text x="400" y="475" text-anchor="middle" font-weight="bold" class="fill-slate-800">Progressive</text>
                            <text x="400" y="490" text-anchor="middle" font-weight="bold" class="fill-slate-800">Myocardial Dysfunction</text>
                            <!-- Arrow from Step 4 to Step 5 -->
                            <line x1="400" y1="450" x2="400" y2="460" stroke="#dc2626" stroke-width="2.5" marker-end="url(#arrow-red)"/>
                        </g>

                        <defs>
                            <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
                                <path d="M 0 0 L 10 5 L 0 10 z" fill="#64748b" />
                            </marker>
                            <marker id="arrow-red" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
                                <path d="M 0 0 L 10 5 L 0 10 z" fill="#dc2626" />
                            </marker>
                        </defs>
                    </svg>
                </div>
            </section>

            <!-- Section 2: HFrEF vs HFpEF -->
            <section id="hf-types" class="card p-6 md:p-8">
                <h2 class="text-3xl font-bold text-slate-800 mb-1">HFrEF vs. HFpEF</h2>
                <p class="text-slate-500 mb-6">Explore the key differences between Heart Failure with <span class="font-semibold text-rose-600">reduced</span> Ejection Fraction and <span class="font-semibold text-indigo-600">preserved</span> Ejection Fraction.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <!-- Normal Heart Column -->
                    <div class="bg-slate-800 p-6 rounded-lg shadow-lg text-center">
                        <h3 class="text-xl font-bold mb-3 text-emerald-400">Normal Heart</h3>
                        <div class="heart-container mx-auto mb-4" id="normal-heart-container">
                            <!-- SVG will be injected here -->
                        </div>
                        <div class="text-left text-sm text-slate-600 mb-2 px-2">
                                <p class="italic mb-1 font-medium">Key visual features:</p>
                                <ul class="list-disc list-inside ml-2 space-y-0.5">
                                    <li>Balanced chamber size</li>
                                    <li>Moderate wall thickness</li>
                                </ul>
                            </div>
                            <p class="font-semibold mt-3">Normal Function</p>
                        <p class="text-sm text-slate-600 mb-2">The ventricle fills and pumps blood efficiently.</p>
                        <p class="text-2xl font-bold text-emerald-500">LVEF 55-70%</p>
                    </div>

                    <!-- HFrEF Column -->
                    <div class="border border-rose-200 rounded-lg p-4 text-center">
                        <h3 class="text-2xl font-bold text-rose-600 mb-2">HFrEF (Systolic Dysfunction)</h3>
                        <div class="heart-container mx-auto mb-4" id="hfref-heart-container">
                            <!-- SVG will be injected here -->
                        </div>
                        <div class="text-left text-sm text-slate-600 mb-2 px-2">
                                <p class="italic mb-1 font-medium">Key visual features:</p>
                                <ul class="list-disc list-inside ml-2 space-y-0.5">
                                    <li>Significantly enlarged chamber (dilated)</li>
                                    <li>Noticeably thin walls (compare to Normal)</li>
                                </ul>
                            </div>
                        <p class="font-semibold mt-3">Primary Problem: Weak Contraction</p>
                        <p class="text-sm text-slate-600 mb-2">The ventricle is dilated and cannot pump blood effectively.</p>
                        <p class="text-2xl font-bold text-rose-600">LVEF ≤ 40%</p>
                    </div>

                    <!-- HFpEF Column -->
                    <div class="border border-indigo-200 rounded-lg p-4 text-center">
                        <h3 class="text-2xl font-bold text-indigo-600 mb-2">HFpEF (Diastolic Dysfunction)</h3>
                        <div class="heart-container mx-auto mb-4" id="hfpef-heart-container">
                             <!-- SVG will be injected here -->
                        </div>
                        <div class="text-left text-sm text-slate-600 mb-2 px-2">
                                <p class="italic mb-1 font-medium">Key visual features:</p>
                                <ul class="list-disc list-inside ml-2 space-y-0.5">
                                    <li>Markedly reduced chamber size</li>
                                    <li>Prominently thick walls (compare to Normal)</li>
                                </ul>
                            </div>
                        <p class="font-semibold mt-3">Primary Problem: Impaired Relaxation</p>
                        <p class="text-sm text-slate-600 mb-2">The ventricle is stiff and hypertrophied, so it cannot fill with blood properly.</p>
                        <p class="text-2xl font-bold text-indigo-600">LVEF ≥ 50%</p>
                    </div>
                </div>
            </section>

            <!-- Section X: Clinical Manifestations (New Section) -->
            <section id="manifestations" class="card p-6 md:p-8">
                <h2 class="text-3xl font-bold text-slate-800 mb-1">Clinical Manifestations of HF</h2>
                <p class="text-slate-500 mb-6">Symptoms in heart failure are often caused by either fluid congestion (due to backup of pressure) or poor perfusion (due to forward flow failure). Left-sided and right-sided HF present with different primary symptom clusters.</p>

                <div class="grid md:grid-cols-2 gap-8 items-start">
                    <!-- Left-Sided HF Column -->
                    <div class="border border-sky-200 rounded-lg p-4">
                        <h3 class="text-2xl font-bold text-sky-700 mb-3">Left-Sided HF (Pulmonary Congestion)</h3>
                        <p class="font-semibold mb-1">Hemodynamic Change:</p>
                        <p class="text-sm text-slate-600 mb-3">Increased pressure and volume in the left ventricle (↑ preload) causes pressure to back up into the lungs, leading to pulmonary congestion.</p>
                        <p class="font-semibold mb-1">Correlated Symptoms:</p>
                        <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                            <li>Persistent cough</li>
                            <li>Dyspnea (shortness of breath)</li>
                            <li>Orthopnea (shortness of breath when lying flat)</li>
                            <li>Paroxysmal nocturnal dyspnea (PND)</li>
                        </ul>
                    </div>

                    <!-- Right-Sided HF Column -->
                    <div class="border border-amber-200 rounded-lg p-4">
                        <h3 class="text-2xl font-bold text-amber-700 mb-3">Right-Sided HF (Systemic Venous Congestion)</h3>
                        <p class="font-semibold mb-1">Hemodynamic Change:</p>
                        <p class="text-sm text-slate-600 mb-3">Often a consequence of untreated left-sided HF. Pressure backs up into the systemic venous system, leading to systemic venous congestion.</p>
                        <p class="font-semibold mb-1">Correlated Symptoms:</p>
                        <ul class="list-disc list-inside text-sm text-slate-600 space-y-1">
                            <li>Jugular venous distention (JVD)</li>
                            <li>Hepatomegaly (enlarged liver)</li>
                            <li>Anorexia</li>
                            <li>Bilateral dependent peripheral edema</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- Section 3: Staging -->
            <section id="staging" class="card p-6 md:p-8">
                <h2 class="text-3xl font-bold text-slate-800 mb-1">HF Staging and Classification</h2>
                <p class="text-slate-500 mb-6">Click on an ACC/AHA stage to see its description, corresponding NYHA classes, and GDMT focus.</p>

                <div class="flex justify-center space-x-2 md:space-x-4 mb-8 flex-wrap gap-2">
                    <button class="stage-button font-bold py-3 px-6 rounded-lg bg-green-100 text-green-800" onclick="showStage('A')">Stage A</button>
                    <button class="stage-button font-bold py-3 px-6 rounded-lg bg-yellow-100 text-yellow-800" onclick="showStage('B')">Stage B</button>
                    <button class="stage-button font-bold py-3 px-6 rounded-lg bg-orange-100 text-orange-800" onclick="showStage('C')">Stage C</button>
                    <button class="stage-button font-bold py-3 px-6 rounded-lg bg-red-100 text-red-800" onclick="showStage('D')">Stage D</button>
                </div>

                <div class="bg-slate-50 rounded-lg p-6 min-h-[200px] grid md:grid-cols-3 gap-6">
                    <div id="stage-display">
                        <h4 class="font-bold text-lg text-slate-700">Select a Stage Above</h4>
                        <p class="text-slate-600"></p>
                    </div>
                    <div id="nyha-display">
                        <h4 class="font-bold text-lg text-slate-700">NYHA Class</h4>
                        <p class="text-slate-600"></p>
                    </div>
                    <div id="gdmt-display">
                        <h4 class="font-bold text-lg text-slate-700">GDMT Focus</h4>
                        <p class="text-slate-600"></p>
                    </div>
                </div>
            </section>

            <!-- Section 4: Pharmacotherapy -->
            <section id="pharmacotherapy" class="card p-6 md:p-8">
                <h2 class="text-3xl font-bold text-slate-800 mb-1">Pharmacotherapy Explorer</h2>
                <p class="text-slate-500 mb-8">Flip the cards to learn about the major drug classes used in Guideline-Directed Medical Therapy (GDMT).</p>

                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="drug-grid">
                    <!-- Drug cards will be injected here by JavaScript -->
                </div>
            </section>

            <!-- Section X: Clinical Pearls (New Section) -->
            <section id="clinical-pearls" class="card p-6 md:p-8">
                <h2 class="text-3xl font-bold text-slate-800 mb-6">Clinical Pearls</h2>
                <div class="space-y-4">
                    <div class="bg-sky-50 border-l-4 border-sky-500 p-4 rounded-md">
                        <h4 class="font-bold text-sky-700 mb-1">Guideline-Directed Medical Therapy (GDMT) is Key</h4>
                        <p class="text-sm text-slate-600">Adherence to GDMT, encompassing evaluation, diagnostics, and tailored interventions, is crucial for maximizing positive outcomes and preventing complications.</p>
                    </div>
                    <div class="bg-lime-50 border-l-4 border-lime-500 p-4 rounded-md">
                        <h4 class="font-bold text-lime-700 mb-1">Interpreting Natriuretic Peptides</h4>
                        <p class="text-sm text-slate-600">NT-proBNP (>125 pg/mL) or BNP (≥35 pg/mL) suggest HF. <strong class="font-semibold">Important:</strong> Use NT-proBNP for monitoring in patients on ARNI therapy, as sacubitril increases BNP levels.</p>
                    </div>
                    <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-md">
                        <h4 class="font-bold text-amber-700 mb-1">Manage Modifiable Risk Factors Aggressively</h4>
                        <p class="text-sm text-slate-600">Hypertension is the single most important modifiable risk factor (control can reduce HF risk by ~50%). Also manage Diabetes Mellitus & Metabolic Syndrome.</p>
                    </div>
                    <div class="bg-violet-50 border-l-4 border-violet-500 p-4 rounded-md">
                        <h4 class="font-bold text-violet-700 mb-1">Evaluating Symptoms: Congestion vs. Poor Perfusion</h4>
                        <p class="text-sm text-slate-600">Focus on symptom clusters. Differentiate signs of <strong class="font-semibold">congestion</strong> (JVD, rales, edema) vs. <strong class="font-semibold">poor perfusion</strong> (cool extremities, altered mental status) to guide acute management.</p>
                    </div>
                    <div class="bg-gray-50 border-l-4 border-gray-500 p-4 rounded-md">
                        <h4 class="font-bold text-gray-700 mb-1">Reminder: HFrEF vs. HFpEF</h4>
                        <p class="text-sm text-slate-600"><strong class="font-semibold">HFrEF (Systolic Dysfunction):</strong> LVEF ≤ 40%, impaired contractility. <br/> <strong class="font-semibold">HFpEF (Diastolic Dysfunction):</strong> LVEF ≥ 50%, often impaired ventricular relaxation/filling.</p>
                    </div>
                </div>
            </section>

            <!-- Section 5: Knowledge Check -->
            <section id="quiz" class="card p-6 md:p-8">
                <h2 class="text-3xl font-bold text-slate-800 mb-2">Knowledge Check</h2>
                <p class="text-slate-600 mb-6">Apply what you've learned with a quick case study.</p>
                <div id="quiz-container" class="bg-slate-50 rounded-lg p-6 shadow-inner">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-md mb-6">
                        <p class="mb-0"><strong class="text-blue-800">Scenario:</strong> A 68-year-old patient with a history of hypertension presents with increasing shortness of breath and a 5 lb weight gain over 3 days. An echocardiogram reveals an LVEF of 30%.</p>
                    </div>
                    
                    <div id="question1" class="mb-6 bg-white p-4 rounded-lg shadow-sm">
                        <p class="font-semibold mb-3 text-slate-800">1. Based on the LVEF, what type of heart failure does this patient have?</p>
                        <div class="space-y-2">
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="false">A) HFpEF (Diastolic)</button>
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="true">B) HFrEF (Systolic)</button>
                        </div>
                    </div>

                    <div id="question2" class="mb-6 hidden bg-white p-4 rounded-lg shadow-sm">
                        <p class="font-semibold mb-3 text-slate-800">2. What ACC/AHA Stage is this patient?</p>
                        <div class="space-y-2">
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="false">A) Stage B</button>
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="true">B) Stage C</button>
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="false">C) Stage D</button>
                        </div>
                    </div>
                    
                    <div id="question3" class="mb-6 hidden bg-white p-4 rounded-lg shadow-sm">
                        <p class="font-semibold mb-3 text-slate-800">3. Which drug class is used primarily for symptom relief of congestion?</p>
                        <div class="space-y-2">
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="false">A) Beta-Blockers</button>
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="false">B) ACE Inhibitors</button>
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="true">C) Diuretics</button>
                        </div>
                    </div>

                    <div id="question4" class="mb-6 hidden bg-white p-4 rounded-lg shadow-sm">
                        <p class="font-semibold mb-3 text-slate-800">4. If the patient in the scenario (LVEF 30%, SOB, weight gain) also reported significant orthopnea and paroxysmal nocturnal dyspnea (PND), these specific symptoms are most classically associated with:</p>
                        <div class="space-y-2">
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="false">A) Right-Sided Heart Failure manifestations</button>
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="true">B) Left-Sided Heart Failure manifestations</button>
                            <button class="quiz-option p-3 border border-slate-300 rounded-lg w-full text-left hover:bg-slate-100 transition-colors duration-200" data-correct="false">C) Both equally and non-specifically</button>
                        </div>
                    </div>

                    <div id="quiz-feedback" class="p-4 rounded-md text-center font-semibold hidden my-4"></div>
                    <div id="quiz-complete" class="text-center hidden bg-green-50 p-6 rounded-lg border border-green-200 my-4">
                        <p class="text-2xl font-bold text-green-600 mb-4">Great Job!</p>
                        <button id="reset-quiz-btn" class="py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 shadow-md transition-all duration-200">Try Again</button>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="text-center mt-16 text-slate-400 text-sm">
            <p>This interactive guide is based on the content of the Chapter 39 Heart Failure Study Guide.</p>
        </footer>

    </div>

    <script>
        // --- Pathophysiology Logic ---
        const stepButtons = document.querySelectorAll('.step-btn');
        // It's better to select all diagram elements directly by class if their IDs might not strictly follow stepN
        const diagramElements = document.querySelectorAll('.patho-diagram-element');

        function showStep(index) { // index is 0 for "Start", 1 for "Step 1", etc.
            if (index === 0) {
                // Hide all diagram elements
                diagramElements.forEach(el => {
                    el.classList.remove('visible');
                });
                // Deactivate all step buttons
                stepButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                // Optionally, if you want the "Start" button (stepButtons[0]) to look active or focused:
                // if (stepButtons.length > 0) stepButtons[0].classList.add('active'); // Or a different class
            } else {
                // Show elements from step1 up to step_n (where n is the 'index')
                diagramElements.forEach(el => {
                    // Assuming element IDs are 'step1', 'step2', etc.
                    const stepNumber = parseInt(el.id.replace('step', ''));
                    if (stepNumber > 0 && stepNumber <= index) {
                        el.classList.add('visible');
                    } else {
                        el.classList.remove('visible');
                    }
                });

                // Activate the correct button and deactivate others
                // stepButtons[0] is "Start", stepButtons[1] is "1. Initial Injury", etc.
                // So, the button for step 'index' is stepButtons[index]
                stepButtons.forEach((btn, i) => {
                    if (i === index) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
        }
        
        // --- HFrEF vs HFpEF SVG Animation Logic ---
        const hfrefSVG = `
            <svg viewBox="0 0 100 100">
                <path d="M 50,95 C 10,70 10,45 20,25 S 35,15 50,30 C 65,15 80,25 90,45 S 90,70 50,95 Z" fill="#fda4af" stroke="#f43f5e" stroke-width="1">
                </path>
            </svg>
        `;

        const normalHeartSVG = `
            <svg viewBox="0 0 100 100">
                <path d="M 50,95 C 15,65 15,40 30,20 S 45,15 50,30 C 55,15 70,20 85,40 S 85,65 50,95 Z" fill="#a7f3d0" stroke="#059669" stroke-width="4">
                </path>
            </svg>
        `;

        const hfpefSVG = `
            <svg viewBox="0 0 100 100">
                 <path d="M 50,95 C 15,65 15,40 30,20 S 45,15 50,30 C 55,15 70,20 85,40 S 85,65 50,95 Z" fill="#c7d2fe" stroke="#4f46e5" stroke-width="9">
                 </path>
            </svg>
        `;
        
        // --- Staging Logic ---
        const stageData = {
            A: { desc: "At high risk for HF but without structural heart disease or symptoms.", nyha: "N/A", gdmt: "Risk factor reduction. Treat HTN, DM, lipids. Encourage lifestyle changes." },
            B: { desc: "Structural heart disease present, but no signs or symptoms of HF.", nyha: "Class I", gdmt: "Initiate foundational therapy for HFrEF: ACEi/ARB + Beta-Blocker." },
            C: { desc: "Structural heart disease with prior or current symptoms of HF.", nyha: "Class I, II, III, or IV", gdmt: "Pillar therapy for HFrEF: ARNI + Beta-Blocker + MRA + SGLT2i. Use diuretics for symptoms." },
            D: { desc: "Refractory HF requiring specialized interventions.", nyha: "Class IV", gdmt: "Continue GDMT. Discuss goals of care. Consider advanced therapies: MCS, transplant, palliative care." }
        };

        const stageDisplay = document.getElementById('stage-display');
        const nyhaDisplay = document.getElementById('nyha-display');
        const gdmtDisplay = document.getElementById('gdmt-display');
        const stageButtons = document.querySelectorAll('.stage-button');

        window.showStage = (stage) => {
            const data = stageData[stage];
            [stageDisplay, nyhaDisplay, gdmtDisplay].forEach(el => el.style.opacity = 0);
            setTimeout(() => {
                stageDisplay.children[0].textContent = `Stage ${stage}`;
                stageDisplay.children[1].textContent = data.desc;
                nyhaDisplay.children[1].textContent = data.nyha;
                gdmtDisplay.children[1].textContent = data.gdmt;
                [stageDisplay, nyhaDisplay, gdmtDisplay].forEach(el => el.style.opacity = 1);
            }, 300);
            stageButtons.forEach(btn => btn.classList.toggle('ring-2', btn.textContent.includes(stage)));
        };

        // --- Drug Card Logic ---
        const drugData = [
            { name: "Diuretics", icon: "droplets", color: "#0ea5e9", moa: "Decrease extracellular fluid volume by promoting salt and water excretion.", effect: "Reduces preload. Mainstay for symptom (congestion) relief.", adverse: "Hypokalemia, dehydration, hypotension." },
            { name: "ACE Inhibitors", icon: "shield-off", color: "#ef4444", moa: "Inhibit RAAS by blocking conversion of Angiotensin I to Angiotensin II.", effect: "Reduces preload & afterload, slows remodeling. Improves mortality.", adverse: "Dry cough, hyperkalemia, angioedema." },
            { name: "ARBs", icon: "shield-alert", color: "#f97316", moa: "Inhibit RAAS by directly blocking the AT1 receptor for Angiotensin II.", effect: "Similar to ACEi. Used when ACEi not tolerated (cough). Improves mortality.", adverse: "Hyperkalemia, hypotension." },
            { name: "ARNIs", icon: "shield-plus", color: "#8b5cf6", moa: "Combines an ARB with a neprilysin inhibitor, boosting beneficial natriuretic peptides.", effect: "Superior to ACEi in reducing mortality and hospitalizations.", adverse: "Hypotension, hyperkalemia. Higher risk of angioedema if combined with ACEi." },
            { name: "Beta-Blockers", icon: "heart-pulse", color: "#16a34a", moa: "Block the effects of the Sympathetic Nervous System (SNS) on the heart.", effect: "Reduces heart rate, workload, and slows remodeling. Improves mortality.", adverse: "Bradycardia, fatigue, hypotension. Start low, go slow." },
            { name: "MRAs", icon: "lock", color: "#eab308", moa: "Block the effects of aldosterone in the kidneys, heart, and blood vessels.", effect: "Reduces sodium retention and myocardial fibrosis. Improves mortality.", adverse: "Hyperkalemia, gynecomastia (spironolactone)." },
            { name: "SGLT2 Inhibitors", icon: "minus-square", color: "#db2777", moa: "Block glucose reabsorption in the kidney, causing glucosuria.", effect: "Osmotic diuresis and other cardioprotective effects. Improves mortality.", adverse: "Genitourinary infections, euglycemic DKA (rare)." }
        ];
        
        function generateDrugCards() {
            const grid = document.getElementById('drug-grid');
            grid.innerHTML = drugData.map(drug => `
                <div class="drug-card h-48 cursor-pointer" onclick="this.classList.toggle('is-flipped')">
                    <div class="drug-card-inner">
                        <div class="drug-card-front">
                            <i data-lucide="${drug.icon}" color="${drug.color}" class="w-12 h-12"></i>
                            <h4 class="text-lg font-bold mt-2 text-center">${drug.name}</h4>
                        </div>
                        <div class="drug-card-back text-xs">
                            <p class="font-bold mb-1">MOA:</p>
                            <p class="mb-2 text-center">${drug.moa}</p>
                            <p class="font-bold mb-1">Effect:</p>
                            <p class="mb-2 text-center">${drug.effect}</p>
                            <p class="font-bold mb-1">Adverse Effects:</p>
                            <p class="text-center">${drug.adverse}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons(); // This is the key function from the Lucide library
        }

        // --- Quiz Logic ---
        let currentQuestion = 1;
        
        // Initialize quiz elements after DOM is fully loaded
        function initQuiz() {
            // Get quiz feedback element
            const quizFeedback = document.getElementById('quiz-feedback');
            if (!quizFeedback) {
                console.error('Quiz feedback element not found');
                return;
            }
            
            // Attach event handlers to all quiz options
            document.querySelectorAll('.quiz-option').forEach(btn => {
                // Get correct answer from data attribute
                const isCorrect = btn.getAttribute('data-correct') === 'true';
                
                // Add event listener
                btn.addEventListener('click', function() {
                    handleAnswer(this, isCorrect, quizFeedback);
                });
            });
            
            // Initialize reset button
            const resetBtn = document.querySelector('#quiz-complete button');
            if (resetBtn) {
                if (resetBtn.hasAttribute('onclick')) {
                    resetBtn.removeAttribute('onclick');
                }
                resetBtn.addEventListener('click', resetQuiz);
            }
            
            console.log('Quiz initialized with', document.querySelectorAll('.quiz-option').length, 'options');
        }
        
        // Handle answer selection
        function handleAnswer(btn, isCorrect, quizFeedback) {
            const parentQuestion = btn.closest('div[id^="question"]');
            if (!parentQuestion) return;
            
            const options = parentQuestion.querySelectorAll('.quiz-option');
            const questionId = parentQuestion.id;
            
            // Clear any previous feedback content
            while (quizFeedback.firstChild) {
                quizFeedback.removeChild(quizFeedback.firstChild);
            }
            
            // Highlight selected answer
            options.forEach(opt => {
                if (opt === btn) {
                    opt.classList.add(isCorrect ? 'bg-green-200' : 'bg-red-200');
                }
            });
            
            // Show feedback
            if (isCorrect) {
                // Correct answer
                quizFeedback.className = 'p-4 rounded-md text-center block bg-green-100 text-green-700';
                const message = document.createElement('p');
                message.className = 'font-semibold';
                message.textContent = 'Correct!';
                quizFeedback.appendChild(message);
                
                // Disable all options in this question
                options.forEach(opt => {
                    opt.disabled = true;
                });
                
                // Proceed to next question after delay
                setTimeout(() => {
                    parentQuestion.classList.add('hidden');
                    quizFeedback.classList.add('hidden');
                    currentQuestion++;
                    const nextQuestion = document.getElementById(`question${currentQuestion}`);
                    if (nextQuestion) {
                        nextQuestion.classList.remove('hidden');
                    } else {
                        document.getElementById('quiz-complete').classList.remove('hidden');
                    }
                }, 1000);
            } else {
                // Incorrect answer
                quizFeedback.className = 'p-4 rounded-md text-center block bg-red-100 text-red-700';
                
                const message = document.createElement('p');
                message.className = 'font-semibold mb-3';
                message.textContent = 'Not quite. Try again!';
                quizFeedback.appendChild(message);
                
                // Add try again button
                const tryAgainBtn = document.createElement('button');
                tryAgainBtn.className = 'py-1 px-4 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 shadow-sm transition-all duration-200';
                tryAgainBtn.textContent = 'Try Again';
                tryAgainBtn.addEventListener('click', () => {
                    // Reset this question only
                    options.forEach(opt => {
                        opt.disabled = false;
                        opt.classList.remove('bg-red-200', 'bg-green-200');
                    });
                    quizFeedback.classList.add('hidden');
                });
                quizFeedback.appendChild(tryAgainBtn);
                
                // Only disable the clicked option
                btn.disabled = true;
            }
        }
        
        // Reset quiz to initial state
        function resetQuiz() {
            currentQuestion = 1;
            document.getElementById('question1').classList.remove('hidden');
            document.getElementById('question2').classList.add('hidden');
            document.getElementById('question3').classList.add('hidden');
            document.getElementById('question4').classList.add('hidden');
            document.getElementById('quiz-complete').classList.add('hidden');
            document.getElementById('quiz-feedback').classList.add('hidden');
            
            document.querySelectorAll('.quiz-option').forEach(btn => {
                btn.disabled = false;
                btn.classList.remove('bg-green-200', 'bg-red-200');
            });
        }
        
        // Make functions available to window scope
        window.checkAnswer = function(btn, isCorrect) {
            handleAnswer(btn, isCorrect, document.getElementById('quiz-feedback'));
        };
        
        window.resetQuiz = resetQuiz;

        // --- Initial setup on page load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize interactive diagram
            showStep(0); 
            
            // Initialize heart SVGs
            const hfpefContainer = document.getElementById('hfpef-heart-container');
            const normalContainer = document.getElementById('normal-heart-container');
            const hfrefContainer = document.getElementById('hfref-heart-container');

            if (normalContainer) normalContainer.innerHTML = normalHeartSVG;
            if (hfrefContainer) hfrefContainer.innerHTML = hfrefSVG;
            if (hfpefContainer) hfpefContainer.innerHTML = hfpefSVG;
            
            // Initialize staging section
            showStage('A'); 
            
            // Initialize drug cards
            generateDrugCards();
            
            // Initialize quiz functionality
            initQuiz();
            
            console.log('All interactive elements initialized');
        });
    </script>
</body>
</html>
